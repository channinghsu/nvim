local completion = {}
local prompts = {
    -- ========== ä»£ç ç†è§£ ==========
    explain = {
        name = "ğŸ’¡ è§£é‡Šä»£ç ",
        prompt = "è¯·è¯¦ç»†è§£é‡Šä»¥ä¸‹ä»£ç çš„ä½œç”¨ã€é€»è¾‘å’Œå·¥ä½œåŸç†ã€‚å¦‚æœæ¶‰åŠå¤æ‚ç®—æ³•ï¼Œè¯·åˆ†æ­¥éª¤è¯´æ˜ã€‚",
    },
    analyze = {
        name = "ğŸ” æ·±åº¦åˆ†æ",
        prompt = "è¯·æ·±å…¥åˆ†æä»¥ä¸‹ä»£ç ï¼š\n1. ä»£ç ç»“æ„å’Œè®¾è®¡æ¨¡å¼\n2. æ½œåœ¨çš„æ€§èƒ½é—®é¢˜\n3. å®‰å…¨æ€§è€ƒè™‘\n4. å¯ç»´æŠ¤æ€§è¯„ä¼°",
    },

    -- ========== ä»£ç æ”¹è¿› ==========
    optimize = {
        name = "âš¡ ä¼˜åŒ–ä»£ç ",
        prompt = "è¯·ä¼˜åŒ–ä»¥ä¸‹ä»£ç ï¼Œé‡ç‚¹å…³æ³¨ï¼š\n1. æ€§èƒ½æå‡ï¼ˆæ—¶é—´/ç©ºé—´å¤æ‚åº¦ï¼‰\n2. ä»£ç ç®€æ´æ€§\n3. å¯è¯»æ€§æ”¹è¿›\nè¯·ç»™å‡ºä¼˜åŒ–åçš„ä»£ç å¹¶è¯´æ˜æ”¹è¿›ç‚¹ã€‚",
    },
    refactor = {
        name = "ğŸ”§ é‡æ„ä»£ç ",
        prompt = "è¯·é‡æ„ä»¥ä¸‹ä»£ç ï¼Œæ”¹è¿›å…¶ç»“æ„ã€å‘½åå’Œç»„ç»‡æ–¹å¼ï¼Œä½¿å…¶æ›´ç¬¦åˆæœ€ä½³å®è·µå’Œè®¾è®¡åŸåˆ™ã€‚",
    },
    simplify = {
        name = "âœ¨ ç®€åŒ–ä»£ç ",
        prompt = "è¯·ç®€åŒ–ä»¥ä¸‹ä»£ç ï¼Œå»é™¤å†—ä½™é€»è¾‘ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´æ˜äº†ï¼Œä½†ä¿æŒåŠŸèƒ½å®Œæ•´ã€‚",
    },

    -- ========== ä»£ç è´¨é‡ ==========
    fix = {
        name = "ğŸ› ä¿®å¤é—®é¢˜",
        prompt = "è¯·åˆ†æå¹¶ä¿®å¤ä»¥ä¸‹ä»£ç ä¸­çš„æ½œåœ¨é—®é¢˜ã€é”™è¯¯å’Œ bugï¼Œå¹¶è§£é‡Šä¿®å¤åŸå› ã€‚",
    },
    review = {
        name = "ğŸ‘€ ä»£ç å®¡æŸ¥",
        prompt = "è¯·ä½œä¸ºèµ„æ·±å·¥ç¨‹å¸ˆå®¡æŸ¥ä»¥ä¸‹ä»£ç ï¼ŒæŒ‡å‡ºï¼š\n1. ä»£ç è´¨é‡é—®é¢˜\n2. æ½œåœ¨ bug\n3. æ”¹è¿›å»ºè®®\n4. æœ€ä½³å®è·µå»ºè®®",
    },
    test = {
        name = "ğŸ§ª ç¼–å†™æµ‹è¯•",
        prompt = "è¯·ä¸ºä»¥ä¸‹ä»£ç ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼ŒåŒ…æ‹¬ï¼š\n1. æ­£å¸¸æƒ…å†µæµ‹è¯•\n2. è¾¹ç•Œæƒ…å†µæµ‹è¯•\n3. å¼‚å¸¸æƒ…å†µæµ‹è¯•",
    },

    -- ========== æ–‡æ¡£ç”Ÿæˆ ==========
    comment = {
        name = "ğŸ“ æ·»åŠ æ³¨é‡Š",
        prompt = "è¯·ä¸ºä»¥ä¸‹ä»£ç æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼ŒåŒ…æ‹¬ï¼š\n1. å‡½æ•°/ç±»çš„ç”¨é€”è¯´æ˜\n2. å‚æ•°è¯´æ˜\n3. è¿”å›å€¼è¯´æ˜\n4. å…³é”®é€»è¾‘çš„è¡Œå†…æ³¨é‡Š",
    },
    doc = {
        name = "ğŸ“š ç”Ÿæˆæ–‡æ¡£",
        prompt = "è¯·æ ¹æ®ä»¥ä¸‹ä»£ç ç”Ÿæˆå®Œæ•´çš„ API æ–‡æ¡£ï¼ŒåŒ…æ‹¬å‡½æ•°ç­¾åã€å‚æ•°è¯´æ˜ã€è¿”å›å€¼ã€ä½¿ç”¨ç¤ºä¾‹å’Œæ³¨æ„äº‹é¡¹ã€‚ä½¿ç”¨ç®€ä½“ä¸­æ–‡ã€‚",
    },
    readme = {
        name = "ğŸ“– ç”Ÿæˆ README",
        prompt = "è¯·ä¸ºä»¥ä¸‹ä»£ç /é¡¹ç›®ç”Ÿæˆè¯¦ç»†çš„ README æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š\n1. é¡¹ç›®ç®€ä»‹\n2. åŠŸèƒ½ç‰¹æ€§\n3. å®‰è£…æ–¹æ³•\n4. ä½¿ç”¨ç¤ºä¾‹\n5. API æ–‡æ¡£\n6. è´¡çŒ®æŒ‡å—",
    },

    -- ========== Git ç›¸å…³ ==========
    commit = {
        name = "ğŸ“¦ æ’°å†™æäº¤ä¿¡æ¯",
        prompt = "è¯·åŸºäºä»¥ä¸‹æ”¹åŠ¨ï¼Œç”Ÿæˆç¬¦åˆ Conventional Commits è§„èŒƒçš„è‹±æ–‡æäº¤ä¿¡æ¯ï¼Œæ ¼å¼ï¼š<type>(<scope>): <subject>",
    },
    changelog = {
        name = "ğŸ“‹ ç”Ÿæˆå˜æ›´æ—¥å¿—",
        prompt = "è¯·æ ¹æ®ä»¥ä¸‹ä»£ç æ”¹åŠ¨ï¼Œç”Ÿæˆæ¸…æ™°çš„å˜æ›´æ—¥å¿—ï¼ˆChangelogï¼‰ï¼Œåˆ†ç±»ä¸ºæ–°å¢ã€ä¿®æ”¹ã€ä¿®å¤ã€åˆ é™¤ç­‰ã€‚",
    },

    -- ========== ä»£ç è½¬æ¢ ==========
    translate = {
        name = "ğŸŒ è¯­è¨€è½¬æ¢",
        prompt = "è¯·å°†ä»¥ä¸‹ä»£ç è½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä¿æŒåŠŸèƒ½å®Œå…¨ä¸€è‡´ï¼Œå¹¶æ·»åŠ å¿…è¦çš„è¯´æ˜ã€‚ç›®æ ‡è¯­è¨€ï¼š",
    },
    modernize = {
        name = "ğŸš€ ç°ä»£åŒ–æ”¹é€ ",
        prompt = "è¯·ä½¿ç”¨ç°ä»£çš„è¯­è¨€ç‰¹æ€§å’Œæœ€ä½³å®è·µé‡å†™ä»¥ä¸‹ä»£ç ï¼Œåˆ©ç”¨æ–°çš„ API å’Œè¯­æ³•ç³–ã€‚",
    },
    typescript = {
        name = "ğŸ”· æ·»åŠ  TypeScript ç±»å‹",
        prompt = "è¯·ä¸ºä»¥ä¸‹ JavaScript ä»£ç æ·»åŠ å®Œæ•´çš„ TypeScript ç±»å‹æ³¨è§£ï¼ŒåŒ…æ‹¬å‡½æ•°ç­¾åã€æ¥å£å®šä¹‰ç­‰ã€‚",
    },

    -- ========== å­¦ä¹ è¾…åŠ© ==========
    learn = {
        name = "ğŸ“ æ•™å­¦è®²è§£",
        prompt = "è¯·ç”¨æ•™å­¦çš„æ–¹å¼è¯¦ç»†è®²è§£ä»¥ä¸‹ä»£ç ï¼Œå‡è®¾è¯»è€…æ˜¯åˆå­¦è€…ï¼Œç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€è¯´æ˜æ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ã€‚",
    },
    example = {
        name = "ğŸ’¼ ä½¿ç”¨ç¤ºä¾‹",
        prompt = "è¯·ä¸ºä»¥ä¸‹ä»£ç /å‡½æ•°æä¾› 3-5 ä¸ªå®é™…ä½¿ç”¨ç¤ºä¾‹ï¼Œè¦†ç›–å¸¸è§åœºæ™¯å’Œç‰¹æ®Šæƒ…å†µã€‚",
    },

    -- ========== å®‰å…¨æ€§ ==========
    security = {
        name = "ğŸ”’ å®‰å…¨å®¡æŸ¥",
        prompt = "è¯·ä»å®‰å…¨è§’åº¦å®¡æŸ¥ä»¥ä¸‹ä»£ç ï¼Œè¯†åˆ«æ½œåœ¨çš„å®‰å…¨æ¼æ´ï¼ˆå¦‚æ³¨å…¥æ”»å‡»ã€XSSã€CSRF ç­‰ï¼‰ï¼Œå¹¶æä¾›ä¿®å¤å»ºè®®ã€‚",
    },

    -- ========== æ€§èƒ½åˆ†æ ==========
    performance = {
        name = "ğŸ“Š æ€§èƒ½åˆ†æ",
        prompt = "è¯·åˆ†æä»¥ä¸‹ä»£ç çš„æ€§èƒ½ç‰¹å¾ï¼š\n1. æ—¶é—´å¤æ‚åº¦\n2. ç©ºé—´å¤æ‚åº¦\n3. æ€§èƒ½ç“¶é¢ˆ\n4. ä¼˜åŒ–å»ºè®®",
    },
}

completion["CopilotC-Nvim/CopilotChat.nvim"] = {
	branch = "main",
	build = "make tiktoken",
	dependencies = {
		{ "nvim-lua/plenary.nvim", branch = "master" },
		{ "nvim-telescope/telescope.nvim" },
		{ "zbirenbaum/copilot.lua" },
	},

	opts = {
		headers = {
			user = "## Channing ",
			assistant = "## Copilot ",
			error = "## Error ",
		},

		separator = "â”â”",
		auto_fold = true,
		auto_insert_mode = true,
		auto_follow_cursor = false,
		show_help = false,
		prompts = prompts,

		mappings = {
			complete = {
				detail = "Use @<Tab> or /<Tab> for options.",
				insert = "<Tab>",
			},
			close = {
				normal = "q",
				insert = "<C-c>",
			},
			reset = {
				normal = "<C-l>",
				insert = "<C-l>",
			},
			submit_prompt = {
				normal = "<CR>",
				insert = "<C-s>",
			},
			accept_diff = {
				normal = "<C-y>",
				insert = "<C-y>",
			},
			yank_diff = {
				normal = "gy",
			},
			show_diff = {
				normal = "gd",
			},
			show_info = {
				normal = "gc",
			},
			show_context = {
				normal = "gh",
			},
		},
	},

	config = function(_, opts)
		local chat = require("CopilotChat")
		local select = require("CopilotChat.select")

		opts.selection = select.unnamed

		opts.prompts.Commit = {
			prompt = "ç”Ÿæˆä¸€æ¡ç¬¦åˆ Conventional Commits è§„èŒƒçš„æäº¤ä¿¡æ¯ï¼ˆä¸­æ–‡ï¼‰ï¼ŒåŸºäºå½“å‰æ”¹åŠ¨å†…å®¹ã€‚",
			selection = select.gitdiff,
		}
		opts.prompts.CommitStaged = {
			prompt = "ç”Ÿæˆä¸€æ¡ç¬¦åˆ Conventional Commits è§„èŒƒçš„æäº¤ä¿¡æ¯ï¼ˆä¸­æ–‡ï¼‰ï¼ŒåŸºäºæš‚å­˜åŒºæ”¹åŠ¨å†…å®¹ã€‚",
			selection = function(source)
				return select.gitdiff(source, true)
			end,
		}

		chat.setup(opts)

		vim.api.nvim_create_user_command("CopilotChatVisual", function(args)
			chat.ask(args.args, { selection = select.visual })
		end, { nargs = "*", range = true })

		vim.api.nvim_create_user_command("CopilotChatInline", function(args)
			chat.ask(args.args, {
				selection = select.visual,
				window = {
					layout = "float",
					relative = "cursor",
					width = 1,
					height = 0.4,
					row = 1,
				},
			})
		end, { nargs = "*", range = true })

		vim.api.nvim_create_user_command("CopilotChatToggle", function()
			chat.toggle()
		end, {})

		vim.api.nvim_create_user_command("CopilotChatReset", function()
			chat.reset()
		end, {})

		vim.api.nvim_set_hl(0, "CopilotChatHeader", { fg = "#7C3AED", bold = true })
		vim.api.nvim_set_hl(0, "CopilotChatSeparator", { fg = "#374151" })
	end,
}

return completion
